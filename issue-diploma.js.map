{"version":3,"file":"issue-diploma.js","sources":["../src/issue-diploma.js"],"sourcesContent":["import {createI18nInstance} from './i18n.js';\nimport {css, html} from 'lit-element';\nimport {ScopedElementsMixin} from '@open-wc/scoped-elements';\nimport * as commonUtils from '@dbp-toolkit/common/utils';\nimport {Button, Icon} from '@dbp-toolkit/common';\nimport * as commonStyles from '@dbp-toolkit/common/styles';\nimport DBPLitElement from '@dbp-toolkit/common/dbp-lit-element';\nimport QRCode from 'webcomponent-qr-code/qr-code';\n\nconst i18n = createI18nInstance();\n\n\nclass IssueDiploma extends ScopedElementsMixin(DBPLitElement) {\n    constructor() {\n        super();\n        this.lang = i18n.language;\n        this.exporting = false;\n\n        this.fetchDiplomas().then((diplomas) => {\n            this.diplomas = diplomas;\n        });\n    }\n\n    static get scopedElements() {\n        return {\n            'dbp-icon': Icon,\n            'dbp-button': Button,\n            'dbp-qr-code': QRCode,\n        };\n    }\n\n    static get properties() {\n        return {\n            lang: { type: String },\n            exporting: { type: Boolean, attribute: false },\n            exportingId: { type: String },\n            diplomas: { type: Array },\n        };\n    }\n\n    connectedCallback() {\n        super.connectedCallback();\n    }\n\n    update(changedProperties) {\n        changedProperties.forEach((oldValue, propName) => {\n            switch (propName) {\n                case \"lang\":\n                    i18n.changeLanguage(this.lang);\n                    break;\n            }\n        });\n\n        super.update(changedProperties);\n    }\n\n    static get styles() {\n        // language=css\n        return css`\n            ${commonStyles.getThemeCSS()}\n            \n            .vc-list {\n              list-style: none;\n              padding: 0;\n            }\n\n            .vc-list li {\n              display: flex;\n              justify-content: space-between;\n              margin-bottom: 1rem;\n            }\n        `;\n    }\n\n    export(id) {\n        console.log('export');\n        this.exporting = true;\n        this.exportingId = id;\n    }\n\n    async httpGetAsync(url, options) {\n        let response = await fetch(url, options).then(result => {\n            if (!result.ok) throw result;\n            return result.json();\n        });\n\n        return response;\n    }\n\n    async fetchDiplomas() {\n        const options = {\n            headers: {\n                Authorization: \"Bearer \" + window.DBPAuthToken\n            }\n        };\n        const baseUrl = 'http://127.0.0.1:8000/';\n        const url = baseUrl + 'diplomas?page=1';\n        const resp = await this.httpGetAsync(url, options);\n        return resp['hydra:member'];\n    }\n\n    // todo: maybe derive diploma and grades from the same activity\n    // todo: check for login\n    // todo: check if did auth is done\n    // todo: fetch list of diplomas\n    // todo: modal with vc qr code\n    // todo: select format, select schema\n    render() {\n        if (!window.DBPAuthToken) {\n            return html`\n                <p>${i18n.t('please-login')}</p>\n            `;\n        }\n\n        if (!this.exporting) {\n\n            const diplomaList = this.diplomas.map((d) => html`\n                <li>\n                    <div>\n                        <strong>${d.name}</strong><br />\n                        ${d.academicDegree}<br />\n                        ${d.achievenmentDate}<br />\n                    </div>\n                    <dbp-button type=\"is-primary\" value=\"Export\" no-spinner-on-click=\"true\" @click=\"${() => this.export(d['@id'])}\" />\n                </li>\n            `);\n\n            return html`\n                <ul class=\"vc-list\">\n                    ${diplomaList}\n                </ul>\n            `;\n        }\n        const qrData = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJFUzI1NksifQ.eyJ2YyI6eyJjcmVkZW50aWFsU3ViamVjdCI6eyJkZWdyZWUiOnsidHlwZSI6IkJhY2hlbG9yRGVncmVlIiwibmFtZSI6IkJhY2hlbG9yIG9mIFNjaWVuY2UgYW5kIEFydHMifX0sIkBjb250ZXh0IjpbImh0dHBzOi8vd3d3LnczLm9yZy8yMDE4L2NyZWRlbnRpYWxzL3YxIiwiaHR0cHM6Ly93d3cudzMub3JnLzIwMTgvY3JlZGVudGlhbHMvZXhhbXBsZXMvdjEiXSwidHlwZSI6WyJWZXJpZmlhYmxlQ3JlZGVudGlhbCIsIlVuaXZlcnNpdHlEZWdyZWVDcmVkZW50aWFsIl19LCJzdWIiOiIiLCJuYmYiOjE2MTI0MjY5OTYsImlzcyI6ImRpZDpldGhyOmFydGlzX3QxOjB4MWViOWEwZDk5YjE4Yjc4YjJmNjdhNDBmYTA5ZmRhODQ2MzVlZjk2NyJ9.7upzlCL3FJieO35TQa4_y9PlmEotXKphtRd9cstWt4Db2LICBl9RT3_aRl0aBRlHs29JJKQWEMSLwnWJOXsYAw';\n\n        return html`\n            <p>\n                ${i18n.t('issue-diploma.scan')}\n            </p>\n            \n            <pre>${JSON.stringify(this.diplomas.filter((d) => d['@id'] === this.exportingId)[0], null, 2)}</pre>\n\n            <dbp-qr-code\n              data=\"${qrData}\"\n              format=\"svg\"\n              modulesize=\"5\"\n              margin=\"1\"\n            ></dbp-qr-code><br />\n\n            <p>\n                ${i18n.t('wallets')}\n            </p>\n            <ul>\n                <li><a href=\"http://minerva.digital/\" target=\"_blank\">Minerva Wallet</a></li>\n                <li>Browser wallet</li>\n            </ul>\n        `;\n    }\n}\n\ncommonUtils.defineCustomElement('issue-diploma', IssueDiploma);\n"],"names":["i18n","createI18nInstance","IssueDiploma","ScopedElementsMixin","DBPLitElement","constructor","lang","language","exporting","fetchDiplomas","then","diplomas","Icon","Button","QRCode","type","String","Boolean","attribute","exportingId","Array","connectedCallback","update","changedProperties","forEach","oldValue","propName","changeLanguage","this","css","commonStyles.getThemeCSS","export","id","console","log","url","options","fetch","result","ok","json","headers","Authorization","window","DBPAuthToken","httpGetAsync","baseUrl","render","html","t","diplomaList","map","d","name","academicDegree","achievenmentDate","JSON","stringify","filter","commonUtils.defineCustomElement"],"mappings":";;;;;;;;;;;;;;;sRASA,MAAMA,EAAOC,IAGb,MAAMC,UAAqBC,EAAoBC,IAC3CC,2BAESC,KAAON,EAAKO,cACZC,WAAY,OAEZC,gBAAgBC,MAAMC,SAClBA,SAAWA,uCAKb,YACSC,eACEC,gBACCC,iCAKZ,CACHR,KAAM,CAAES,KAAMC,QACdR,UAAW,CAAEO,KAAME,QAASC,WAAW,GACvCC,YAAa,CAAEJ,KAAMC,QACrBL,SAAU,CAAEI,KAAMK,QAI1BC,0BACUA,oBAGVC,OAAOC,GACHA,EAAkBC,SAAQ,CAACC,EAAUC,YACzBA,OACC,OACD1B,EAAK2B,eAAeC,KAAKtB,gBAK/BgB,OAAOC,8BAKNM,SAAI;cAAX;;;;;;;;;;;;WACMC,KAeVC,OAAOC,GACHC,QAAQC,IAAI,eACP1B,WAAY,OACZW,YAAca,qBAGJG,EAAKC,gBACCC,MAAMF,EAAKC,GAAS1B,MAAK4B,QACrCA,EAAOC,GAAI,MAAMD,SACfA,EAAOE,sCAOZJ,EAAU,CACZK,QAAS,CACLC,cAAe,UAAYC,OAAOC,4BAKvBhB,KAAKiB,aADZC,wCAC8BV,IAC9B,gBAShBW,aACSJ,OAAOC,oBACDI,SAAK;qBAAZ;eACShD,EAAKiD,EAAE,qBAIfrB,KAAKpB,UAAW,OAEX0C,EAActB,KAAKjB,SAASwC,KAAKC,GAAMJ,SAAK;;;kCAAZ;0BAAA;0BAAA;;sGAAA;;eAGhBI,EAAEC,KACVD,EAAEE,eACFF,EAAEG,kBAE0E,IAAM3B,KAAKG,OAAOqB,EAAE,mBAIvGJ,SAAK;;sBAAZ;;eAEUE,UAMPF,SAAK;;kBAAZ;;;mBAAA;;;sBAAA;;;;;;;kBAAA;;;;;;WAEUhD,EAAKiD,EAAE,sBAGNO,KAAKC,UAAU7B,KAAKjB,SAAS+C,QAAQN,GAAMA,EAAE,SAAWxB,KAAKT,cAAa,GAAI,KAAM,GAPhF,qmBAiBLnB,EAAKiD,EAAE,aAUzBU,EAAgC,gBAAiBzD"}